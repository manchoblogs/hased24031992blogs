!function(e,o,t){var i={init:function(o,t){var i=this;i.$elem=t,i.className="content-timeline__item",i.$onItem=e("."+i.className+":in-viewport("+i.treshold+")"),i.loadStatus=!0,i.page=1,i.perpage=20,i.beforeLoad=0,i.options=e.extend({},e.fn.wtTimeline.options,i.$elem.data(),o),i.$header=e(i.options.header),i.treshold=i.$header.height(),i.$filter=e(i.options.filter),i.$order=e(i.options.order),i.filterType=i.options.filterType,i.limit=i.options.limit,i.$container=e(i.options.container),i.$spinner=e(i.options.spinner),i.$loadMore=e(i.options.loadMore),i.path=i.options.path,i.onScroll(),null==i.options.pagination&&i.onLoadMore(),i.options.filter&&i.onChangeFilter(),i.options.order&&i.onChangeOrder()},onScroll:function(){var t=this;e(o).on("scroll",function(){null==t.options.pagination&&e(this).scrollTop()+e(this).height()>=t.$container.height()-t.beforeLoad&&t.page<=t.limit&&1==t.loadStatus&&(t.page++,t.loadStatus=!1,t.getFilter(),t.loading(!0),t.loadContent())})},onChangeFilter:function(){var e=this;e.$filter.on("change",function(){e.getFilter(),e.options.pagination?e.urlBuilder("filter_type"):(e.$loadMore.hide(),e.loading(!0),e.page=1,e.loadStatus=!1,e.loadContent(),e.$container.addClass("is-hide"))})},onChangeOrder:function(){var e=this;e.$order.on("change",function(){e.getOrder(),e.options.pagination?e.urlBuilder("order"):(e.$loadMore.hide(),e.loading(!0),e.page=1,e.loadStatus=!1,e.loadContent(),e.$container.addClass("is-hide"))})},onLoadMore:function(){var e=this;e.$loadMore.on("click",function(){e.show=!1,e.page++,e.getFilter(),e.loadContent(),e.$loadMore.hide(),e.loading(!0)})},loadContent:function(){var o=this;e.ajax({type:"GET",url:o.path,data:{filter_type:o.filterType,page:o.page,perpage:o.perpage},dataType:"HTML",success:function(t){t?(o.$container.removeClass("is-hide"),o.page>1?o.$container.append(t):o.$container.html(t),o.loadStatus=!0,o.loading(!1),e(".lazy").lazyload({threshold:200,failure_limit:20}).removeClass("lazy").addClass("lazyloaded"),o.page>o.limit&&o.$loadMore.show()):(o.loadStatus=!1,o.$spinner.hide())},error:function(e){console.log(e)}})},loading:function(e){var o=this;1==e?o.$spinner.show():o.$spinner.hide()},getFilter:function(){var e=this;e.filterType=e.$filter.val()},getOrder:function(){var e=this;e.order=e.$order.val()},urlBuilder:function(e){var i=this,n=t.createElement("a");n.href=o.location.href;var r=n.origin+n.pathname,a=n.search.replace("?","").split("&");if(a.length>0&&""!=a[0]){var l={};a.forEach(function(e,o){var t=e.split("="),n=t[0],r=t[1];"q"==n&&(l[n]=decodeURIComponent(r.replace(/\+/g," "))),"filter_type"==n&&(l[n]="undefined"!=typeof i.filterType?i.filterType:r),"order"==n&&(l[n]="undefined"!=typeof i.order?i.order:r)}),l="?"+jQuery.param(l),l.indexOf(e)<=-1&&("filter_type"==e?l+="&filter_type="+i.filterType:"order"==e&&(l+="&order="+i.order)),r+=l}else l="undefined"!=typeof i.filterType?"?filter_type="+i.filterType:"?order="+i.order,r+=l;o.location.href=r}};e.fn.wtTimeline=function(o){var t=Object.create(i);t.init(o,e(this))}}(jQuery,window,document);